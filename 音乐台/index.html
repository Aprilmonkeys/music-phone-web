<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
		<title>index</title>
		<link rel="stylesheet" type="text/css" href="css/index.css" />
	</head>

	<body>
		<div id="wrap">
			<!--头部开始-->
			<div id="header">
				<div id="headerTop">
					<div id="logo">
						<a href="###"><img src="img/logo.png" alt="" /></a>
					</div>
					<a href="###" id='menuBtn' class='menuClos'>
					</a>
					<div id="nav">
						<a href="###" id='smallS'>搜索</a>
						<a href="###">登录</a>
						<a href="###">注册</a>
					</div>
				</div>
				<form id="search">
					<input type="text" placeholder="请输入搜索内容" />
					<input type="submit" value="搜索" />
				</form>
				<div id="mask">
					<ul>
						<li>
							<a href="javascript:;">首页</a>
						</li>
						<li>
							<a href="javascript:;">MV</a>
						</li>
						<li>
							<a href="javascript:;">悦单</a>
						</li>
						<li>
							<a href="javascript:;">V榜</a>
						</li>
						<li>
							<a href="javascript:;">音悦</a>
						</li>
						<li>
							<a href="javascript:;">商城</a>
						</li>
						<li>
							<a href="javascript:;">节目</a>
						</li>
						<li>
							<a href="javascript:;">饭团</a>
						</li>
						<li>
							<a href="javascript:;">资讯</a>
						</li>
						<li>
							<a href="javascript:;">我的家</a>
						</li>
						<li>
							<a href="javascript:;">APP下载</a>
						</li>
						<li>
							<a href="javascript:;">热门应用</a>
						</li>

					</ul>
				</div>
			</div>
			<!--内容开始-->
			<div id="content">
				<div id="navWrap">
					<ul id='navList'>
						<li class='active'>
							<a href='javascript:;'>首页</a>
						</li>
						<li>
							<a href="javascript:;">MV</a>
						</li>
						<li>
							<a href="javascript:;">悦单</a>
						</li>
						<li>
							<a href="javascript:;">V榜</a>
						</li>
						<li>
							<a href="javascript:;">音悦</a>
						</li>
						<li>
							<a href="javascript:;">商城</a>
						</li>
						<li>
							<a href="javascript:;">节目</a>
						</li>
						<li>
							<a href="javascript:;">饭团</a>
						</li>
						<li>
							<a href="javascript:;">资讯</a>
						</li>
						<li>
							<a href="javascript:;">我的家</a>
						</li>
						<li>
							<a href="javascript:;">APP下载</a>
						</li>
						<li>
							<a href="javascript:;">热门应用</a>
						</li>
					</ul>
				</div>
				<!--banner-->
				<div id="ban_wrap">
					<ul id="ban_list">
						<li>
							<a href="###">
								<img src="img/1.jpg" />
							</a>
						</li>
						<li>
							<a href="###">
								<img src="img/2.jpg" />
							</a>
						</li>
						<li>
							<a href="###">
								<img src="img/3.jpg" />
							</a>
						</li>
						<li>
							<a href="###">
								<img src="img/4.jpg" />
							</a>
						</li>
						<li>
							<a href="###">
								<img src="img/5.jpg" />
							</a>
						</li>
					</ul>
					<div id="ban_nav">
						<span class="active"></span>
						<span></span>
						<span></span>
						<span></span>
						<span></span>
					</div>
				</div>
				<!--列表项-->
				<div class='tab'>
					<div class="tab-header">
						<h2>MV首播</h2>
						<a href="###">更多&gt;</a>
					</div>
					<nav class='tab_nav'>
						<a href="#">全部</a>
						<a href="#">内地</a>
						<a href="#">港台</a>
						<a href="#">欧美</a>
						<a href="#">韩国</a>
						<a href="#">日本</a>
						<span class='smallG'></span>
					</nav>
					<div class="tab_wrap">
						<ul class='tab-loading'></ul>
						<ul class="tab-list">
							<li>
								<img src="img/a.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/b.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/c.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/d.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/e.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/e.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
						</ul>
						<ul class='tab-loading'></ul>
					</div>

				</div>
				<div class='tab'>
					<div class="tab-header">
						<h2>MV首播</h2>
						<a href="###">更多&gt;</a>
					</div>
					<nav class='tab_nav'>
						<a href="#">全部</a>
						<a href="#">内地</a>
						<a href="#">港台</a>
						<a href="#">欧美</a>
						<a href="#">韩国</a>
						<a href="#">日本</a>
						<span class='smallG'></span>
					</nav>
					<div class="tab_wrap">
						<ul class='tab-loading'></ul>
						<ul class="tab-list">
							<li>
								<img src="img/a.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/b.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/c.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/d.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/e.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
							<li>
								<img src="img/e.jpg" alt="" />
								<span>樱花樱花樱花</span>
								<div class="ice">
									<div class="ice-left">
										<span class="ice-pic"></span>
										<span>9167</span>
									</div>
									<div class="ice-right">
										<span class="ice-pic"></span>
										<span>9</span>
									</div>
								</div>
							</li>
						</ul>
						<ul class='tab-loading'></ul>
					</div>

				</div>

			</div>
		</div>

	</body>
	<script type="text/javascript" src="js/transformCss.js">
	</script>
	<script type="text/javascript">
		document.addEventListener('touchstart', function(event) {
			event.preventDefault();
		});
		//rem 适配 页面宽度适应屏幕宽度
		(function() {
			var width = document.documentElement.clientWidth;
			var styleN = document.createElement('style');
			styleN.innerHTML = 'html{font-size:' + width / 16 + 'px !important;}';
			document.head.appendChild(styleN);
		})();
		//banner tab 里边都有图片
		window.onload = function() {
			banner();
			tab();
		}
		//tab列表项的切换
		function tab() {
			var tab_wrap = document.querySelectorAll('.tab_wrap');
			var tab_nav = document.querySelectorAll('.tab_nav');
			console.log(tab_nav);
			var translateX = tab_nav[0].offsetWidth;
			for(var i = 0; i < tab_wrap.length; i++) {
				move(tab_wrap[i],tab_nav[i]);
			}
			//1 先把ul 放中间
			function move(tab_wrap,tab_nav) {
				//通过translateX把中间的ul置回
				transformCss(tab_wrap, 'translateX', -translateX);
				//8 加上3D效果
				transformCss(tab_wrap, 'translateZ', 0.1);
				transformCss(tab_nav, 'translateZ', 0.1);
				
				//2 开始横向滑动
				var eleX = 0;
				var startX = 0;
				var disX = 0;
				//3 防抖动 通过Y>X上的距离 禁止X的位移
				var startY=0;
				var isFirst=true;
				var isX=true;
				//6 判断load 图片是否显示 定义一个标识
				var isLoad=false;
				//获取loading的图片
				var loadings=document.querySelectorAll('.tab_wrap .tab-loading');
				//7 移动小绿条 
				var smallG=tab_nav.querySelector('.smallG');
				var aNodes=tab_nav.querySelectorAll('a');
				var nowG=0;
				
				tab_wrap.addEventListener('touchstart', function(event) {
				var touch = event.changedTouches[0]; //获取手指列表项中的一个手指
				if(isLoad){
					return;
				}
				//手动清除过渡
				tab_wrap.style.transition='none';
				eleX = transformCss(tab_wrap, 'translateX');
				startX = touch.clientX;
				startY=touch.clientY;
				//重置 isFirst 和isX的状态
				isFirst=true;
				isX=true;
			});
			tab_wrap.addEventListener('touchmove', function(event) {
				var touch = event.changedTouches[0]; //获取手指列表项中的一个手指
				if(isLoad){
					return;
				}
				//一上来要判断 isX 是否是true
				if(!isX){
					return;
				}
				var endX = touch.clientX;
				var disX = endX - startX;
				var endY=touch.clientY;
				var disY=endY-startY;
				if(isFirst){
					isFirst=false;
					if(Math.abs(disY)>Math.abs(disX)){
						isX=false;
						return;
					}
				}
				transformCss(tab_wrap, 'translateX', disX + eleX);
				//5手指滑过屏幕的1/2,图片滑到下一个图片中 还是在滑动的过程 在touchmove 里操作
				if(Math.abs(disX)>translateX/2){
					//定义一个目标宽度接受图片要跳转的地方
					var targetW = disX > 0 ? 0 : -2*translateX;
					tab_wrap.style.transition='0.5s';
					transformCss(tab_wrap,'translateX',targetW);
					
					//小绿条滑过的判断
					if(disX<0){
						nowG+=1;
					}else{
						nowG-=1;
					};
					if(nowG<0){
						nowG=aNodes.length-1;
					}else if(nowG>aNodes.length-1){
						nowG=0;
					}
					smallG.style.transition='0.5s';
					transformCss(smallG,'translateX',aNodes[nowG].offsetLeft)
					//  手指滑过 1/2  loading显示  
					isLoad=true;
					//在过渡结束之后显示   transitionEnd

					tab_wrap.addEventListener('transitionEnd',fun);
					tab_wrap.addEventListener('webkitTransitionEnd',fun);//兼容
					//loadings显示 通过opcity
					function fun(){
						for(var i=0;i<loadings.length;i++){
							loadings[i].style.opacity='1';
						}
						//过几秒数据请求回来之后 loading会消失
						setTimeout(function(){
							for(var i=0;i<loadings.length;i++){
								loadings[i].style.opacity='0';
							}
							isLoad=false;
							tab_wrap.style.transition='0.2s';
							transformCss(tab_wrap,'translateX',-translateX);
						},200)
						//给transitionEnd 解绑
						tab_wrap.removeEventListener('transitionEnd',fun);
						tab_wrap.removeEventListener('webkitTransitionEnd',fun);
					}
				}

			})
			//4 手指没有滑过屏幕的1/2 图片回到上一个图片的位置 在end里操作
			
			tab_wrap.addEventListener('touchend', function(event) {
				var touch = event.changedTouches[0]; //获取手指列表项中的一个手指
				if(isLoad){
					return;
				}
				var endX=touch.clientX;
				var disX=endX-startX;
				//如果小于一半的距离不管往哪滑都会回到图片最先的位置
				if(Math.abs(disX)<translateX/2){
					tab_wrap.style.transition='0.5';
					transformCss(tab_wrap,'translateX',-translateX);
				}
			})
			}

			

		}

		function banner() {
			//获取元素
			var wrap = document.getElementById('ban_wrap');
			var list = document.getElementById('ban_list');
			transformCss(list, 'translateZ', 0.1);
			
			//动态添加li
			list.innerHTML += list.innerHTML;
			var liNodes = document.querySelectorAll('#ban_list li');
			var spanNodes = document.querySelectorAll('#ban_nav span');
			//布局
			var styleN = document.createElement('style');
			styleN.innerHTML = '#ban_list{width: ' + liNodes.length + '00%;}';
			styleN.innerHTML += '#ban_list li{width:' + (100 / liNodes.length) + '% ;}';
			styleN.innerHTML += '#ban_wrap{height: ' + liNodes[0].offsetHeight + 'px;}';
			document.head.appendChild(styleN);

			//横向滑屏
			//定义元素和手指初始位置
			var eleX = 0;
			var startX = 0;
			var disX = 0;
			var startY = 0;
			//防抖动屏幕 
			//判断是否是第一次滑屏
			var isFirst = true;
			//X方向的值
			var isX = true;
			//定时器
			var timer = 0;
			//图片索引下标
			var now = 0;
			wrap.addEventListener('touchstart', function(event) {
				var touch = event.changedTouches[0];
				//清除定时器
				clearInterval(timer);
				//清除过渡
				list.style.transition = 'none';
				//无缝---跳转
				var left = transformCss(list, 'translateX');
				var now = Math.round(-left / document.documentElement.clientWidth);
				if(now == 0) {
					now = spanNodes.length;
				} else if(now == liNodes.length - 1) {
					now = spanNodes.length - 1;
				};
				//真正的跳转工作
				transformCss(list, 'translateX', -now * document.documentElement.clientWidth);
				//元素初始位置
				//读
				eleX = transformCss(list, 'translateX');
				//手指初始位置
				startX = touch.clientX;
				startY = touch.clientY;
				//给isX和isFirst 重置
				isX = true;
				isFirst = true;
			});
			wrap.addEventListener('touchmove', function(event) {
				var touch = event.changedTouches[0];
				//禁止X方向的移动
				if(!isX) {
					return;
				}
				//手指结束位置
				var endX = touch.clientX;
				var endY = touch.clientY;
				//手指距离差
				disX = endX - startX;
				disY = endY - startY;
				//在这判断 是否是第一次滑屏
				if(isFirst) {
					isFirst = false;
					if(Math.abs(disY) > Math.abs(disX)) {
						isX = false;
						return;
					}
				}
				//元素最终位置
				//写
				transformCss(list, 'translateX', disX + eleX);
			});
			//touch end
			wrap.addEventListener('touchend', function(event) {
				var touch = event.changedTouches[0];

				//ul偏移量
				//读
				var left = transformCss(list, 'translateX');
				//Math.round()四舍五入
				now = Math.round(-left / document.documentElement.clientWidth);

				//限定now范围
				if(now < 0) {
					now = 0;
				} else if(now > liNodes.length - 1) {
					now = liNodes.length - 1;
				};

				//过渡
				list.style.transition = '1s';

				//元素跳转位置
				//写
				transformCss(list, 'translateX', -now * document.documentElement.clientWidth);

				//同步小圆点
				for(var i = 0; i < spanNodes.length; i++) {
					//给所有span加class
					spanNodes[i].className = '';
				};
				spanNodes[now % spanNodes.length].className = 'active';

				//开启定时器
				auto();
			});
			//自动轮播
			//模拟now 图片索引下标
			//var now = 0;
			auto();

			function auto() {
				//优化
				clearInterval(timer);
				timer = setInterval(function() {
					//无缝
					if(now == liNodes.length - 1) {
						now = spanNodes.length - 1;
					};
					//清除过渡
					list.style.transition = 'none';
					//跳转
					transformCss(list, 'translateX', -now * document.documentElement.clientWidth);

					//自动播放
					setTimeout(function() {
						now++;
						list.style.transition = '0.5s';
						//写
						transformCss(list, 'translateX', -now * document.documentElement.clientWidth);
						//同步小圆点
						for(var i = 0; i < spanNodes.length; i++) {
							//给所有span加class
							spanNodes[i].className = '';
						};
						spanNodes[now % spanNodes.length].className = 'active';
					}, 20);

				}, 1000);
			};
		};
		//拖动 导航
		nav();

		function nav() {
			var navWrap = document.getElementById('navWrap');
			var navList = document.getElementById('navList');
			//定义元素的初始位置
			var eleX = 0;
			var startX = 0;
			var endX = 0;
			//开始快速滑屏 手指滑动的距离 控制的屏幕快速滑动更大的距离 
			var beginValue = 0;
			var beginTime = 0;
			var endValue = 0;
			var endTime = 0;
			var disValue = 0;
			var disTime = 1;
			//touchstart 
			navWrap.addEventListener('touchstart', function(event) {
				var touch = event.changedTouches[0];
				navList.style.transition = 'none';
				eleX = transformCss(navList, 'translateX');
				startX = touch.clientX;
				beginValue = eleX;
				beginTime = new Date().getTime(); //获取当前时间
				//清除元素的状态 
				disValue = 0;
			})
			//touchmove
			navWrap.addEventListener('touchmove', function(event) {
				var touch = event.changedTouches[0];
				endX = touch.clientX;
				var disX = endX - startX;
				var translateX = disX + eleX;
				var minX = document.documentElement.clientWidth - navList.offsetWidth;
				//加判断 限制2边的临界
				var scale = 0;
				if(translateX > 0) {
					//空白 橡皮筋的效果 手指滑动的距离 和 list移动的距离
					scale = 1 - translateX / document.documentElement.clientWidth;
					translateX = translateX * scale;
				} else if(translateX < minX) {
					var over = minX - translateX;
					scale = 1 - over / document.documentElement.clientWidth
					translateX = minX - over * scale;
				}
				transformCss(navList, 'translateX', translateX)
				// 在move里的 结束时间 结束距离
				endTime = new Date().getTime();
				endValue = translateX;
				disTime = endTime - beginTime;
				disValue = endValue - beginValue;
			})
			//touchend
			navWrap.addEventListener('touchend', function(event) {
				var touch = event.changedTouches[0];
				var speed = disValue / disTime;
				var target = transformCss(navList, 'translateX') + speed * 100; //读的操作
				var minX = document.documentElement.clientWidth - navList.offsetWidth;

				//0,.75,.08,1.78 cubic-bezier(0,.75,.08,1.78)
				var bezier = '';
				if(target > 0) {
					target = 0;
					bezier = 'cubic-bezier(0,.75,.08,1.78)';
				} else if(target < minX) {
					target = minX;
					bezier = 'cubic-bezier(0,.75,.08,1.78)';
				}
				//这里设置了事件 在开始的状态要清除下事件 否则状态不流畅
				navList.style.transition = '1s' + bezier;
				transformCss(navList, 'translateX', target);
			})
		}
		//changeColor
		//误触

		changeColor();

		function changeColor() {
			var liNodes = document.querySelectorAll('#navList li'); //遍历
			//解决误触
			var flag = false;
			for(var i = 0; i < liNodes.length; i++) {
				liNodes[i].addEventListener('touchmove', function() {
					flag = true;
				})

				liNodes[i].addEventListener('touchend', function() {
					if(!flag) {
						for(var j = 0; j < liNodes.length; j++) {
							liNodes[j].className = '';
						}
						this.className = 'active';
					} //重置
					flag = false;
				})

			}
		}
		var menuBtn = document.getElementById('menuBtn');
		var mask = document.getElementById('mask');
		//点击按钮 图片更换 mask显示 或隐藏
		menuBtn.addEventListener('touchstart', function(event) {
			if(menuBtn.className === 'menuClos') {
				menuBtn.className = 'menuOpen';
				mask.style.display = 'block';
			} else if(menuBtn.className === 'menuOpen') {
				menuBtn.className = 'menuClos';
				mask.style.display = 'none';
			}
			//取消冒泡
			event.stopPropagation();
		})
		//优化 点击页面别的地方 mask隐藏
		document.addEventListener('touchstart', function() {
			menuBtn.className = 'menuClos';
			mask.style.display = 'none';
		})
		// 取消 mask 的冒泡
		mask.addEventListener('touchstart', function() {
			event.stopPropagation();
		})
		
	</script>

</html>